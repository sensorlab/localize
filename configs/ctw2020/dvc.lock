schema: '2.0'
stages:
  prepare:
    cmd:
    - unzip -d ../../artifacts/ctw2020/data/raw/ -j ../../artifacts/ctw2020/data/raw/CTW2020_labelled_data.zip
      "CTW2020_labelled_data/*.hdf5"
    - "python ../../src/ctw2020/prepare.py ../../artifacts/ctw2020/data/raw/file_*.hdf5\
      \ --output ../../artifacts/ctw2020/data/interim/ctw2020.pkl\n"
    - rm ../../artifacts/ctw2020/data/raw/*.hdf5
    deps:
    - path: ../../artifacts/ctw2020/data/raw/CTW2020_labelled_data.zip
      hash: md5
      md5: 173971ddd04d9f69af0aa88f90c2513d
      size: 3246322711
    - path: ../../src/ctw2020/prepare.py
      hash: md5
      md5: 6f86ecddc22d118ad9592c67d785e2f8
      size: 1227
    outs:
    - path: ../../artifacts/ctw2020/data/interim/ctw2020.pkl
      hash: md5
      md5: b6b5cafc5a0173afb1187a2b43291da7
      size: 10310971718
  featurize:
    cmd: "python ../../src/ctw2020/featurize.py --input ../../artifacts/ctw2020/data/interim/ctw2020.pkl\
      \ --output ../../artifacts/ctw2020/data/prepared/ctw2020.pkl\n"
    deps:
    - path: ../../artifacts/ctw2020/data/interim/ctw2020.pkl
      hash: md5
      md5: b6b5cafc5a0173afb1187a2b43291da7
      size: 10310971718
    - path: ../../src/ctw2020/featurize.py
      hash: md5
      md5: 9e43c3d5c0e2f82e4ca1d9a72cad31dc
      size: 1576
    outs:
    - path: ../../artifacts/ctw2020/data/prepared/ctw2020.pkl
      hash: md5
      md5: bea9e053dabd5507008cd142d278559c
      size: 10311111051
  split@Random:
    cmd: "python ../../src/ctw2020/split.py --input ../../artifacts/ctw2020/data/prepared/ctw2020.pkl\
      \ --split Random --output-indices ../../artifacts/ctw2020/data/splits/RandomSplit.pkl\n"
    deps:
    - path: ../../artifacts/ctw2020/data/prepared/ctw2020.pkl
      hash: md5
      md5: bea9e053dabd5507008cd142d278559c
      size: 10311111051
    - path: ../../src/ctw2020/split.py
      hash: md5
      md5: 8bac1c6e719c42c8361900f8dc380a92
      size: 1785
    params:
      params.yaml:
        split:
          seed: 42
          n_splits: 5
          test_size: 0.2
    outs:
    - path: ../../artifacts/ctw2020/data/splits/RandomSplit.pkl
      hash: md5
      md5: 7042559c7e0dd6ff6535f053041287c0
      size: 996571
  flatten:
    cmd: "python ../../src/ctw2020/flatten.py --input ../../artifacts/ctw2020/data/prepared/ctw2020.pkl\
      \ --output ../../artifacts/ctw2020/data/prepared/ctw2020.flatten.pkl\n"
    deps:
    - path: ../../artifacts/ctw2020/data/prepared/ctw2020.pkl
      hash: md5
      md5: bea9e053dabd5507008cd142d278559c
      size: 10311111051
    - path: ../../src/ctw2020/flatten.py
      hash: md5
      md5: a185fffb436cdff572a4b0a331ce1923
      size: 855
    outs:
    - path: ../../artifacts/ctw2020/data/prepared/ctw2020.flatten.pkl
      hash: md5
      md5: 88d6c6575b5c9bc6b43cae805debcf6b
      size: 10311111019
  benchmark@Random-model0:
    cmd: "python ../../src/benchmark.py --use XGBRegressor --data ../../artifacts/ctw2020/data/prepared/ctw2020.flatten.pkl\
      \ --split-indices ../../artifacts/ctw2020/data/splits/RandomSplit.pkl --output-results\
      \ ../../artifacts/ctw2020/models/XGBRegressor-RandomSplit-results.pkl\n"
    deps:
    - path: ../../artifacts/ctw2020/data/prepared/ctw2020.flatten.pkl
      hash: md5
      md5: 88d6c6575b5c9bc6b43cae805debcf6b
      size: 10311111019
    - path: ../../artifacts/ctw2020/data/splits/RandomSplit.pkl
      hash: md5
      md5: 7042559c7e0dd6ff6535f053041287c0
      size: 996571
    - path: ../../src/benchmark.py
      hash: md5
      md5: f7257f6eda31513a56fd6fac7c22eeaa
      size: 8243
    params:
      params.yaml:
        models.XGBRegressor:
          module: xgboost
          class: XGBRegressor
          parameters:
            random_state: 42
            enable_categorical: true
    outs:
    - path: ../../artifacts/ctw2020/models/XGBRegressor-RandomSplit-results.pkl
      hash: md5
      md5: 7365890c805531d2b11d2e449630a669
      size: 399329
  evaluation:
    cmd: "python ../../src/report.py ../../artifacts/ctw2020/models/*-results.pkl\
      \ --output-report ../../artifacts/ctw2020/reports/metrics.json\n"
    deps:
    - path: ../../artifacts/ctw2020/models
      hash: md5
      md5: b48a2d65530d36fae6ead077d7634a62.dir
      size: 399329
      nfiles: 2
    - path: ../../src/report.py
      hash: md5
      md5: d315d71b09a199d1b584e640cf9afe0f
      size: 1644
    outs:
    - path: ../../artifacts/ctw2020/reports/metrics.json
      hash: md5
      md5: 8e39195bbdb83ad6b0f33080123d2579
      size: 184
